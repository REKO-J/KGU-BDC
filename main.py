from openai import OpenAI
from streamlit_chat import message
import streamlit as st

API_KEY = st.secrets['API_KEY']

client = OpenAI(
    api_key=API_KEY
)

def ask(user_input):
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[
            {
                "role": "system",
                "content": "ë‹¹ì‹ ì€ ê²½ê¸°ëŒ€í•™êµ ë¹…ë°ì´í„° ìº í”„ì— ëŒ€í•´ ì•Œë ¤ì£¼ëŠ” ì±—ë´‡ì…ë‹ˆë‹¤."
                },
            {
                "role": "system",
                "content": """
                <ìº í”„ ì†Œê°œ>
                ë¹…ë°ì´í„°ì— ê´€ì‹¬ìˆëŠ” ëª¨ë‘ë¥¼ ìœ„í•œ ê²½ê¸°ëŒ€ ë¹…ë°ì´í„°ì„¼í„°ì…ë‹ˆë‹¤.
                ë¬´ì—‡ì„ ì–´ë–»ê²Œ ì‹œì‘í•´ì•¼ í• ì§€ ë§‰ë§‰í•œ ì˜ˆë¹„ì°½ì—…ìë¶€í„° ë¹…ë°ì´í„°ë¥¼ í™œìš©í•´ ì»¨ì„¤íŒ…ì„ ë°›ê³  ì‹¶ì€ ê¸°ì¡´ ì‚¬ì—…ìê¹Œì§€ ë¹…ë°ì´í„°ê°€ ê¶ê¸ˆí•˜ì‹  ëª¨ë“ ë¶„ë“¤ì„ ìœ„í•œ ë¹…ë°ì´í„°ì„¼í„°ì˜ ì§€ì‹ê³¼ ë…¸í•˜ìš°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„° AI í—ˆë¸Œ ì—­í• ì„ í•˜ê³ ì í•©ë‹ˆë‹¤.
                ì£¼ì†Œ: ê²½ê¸°ë„ ìˆ˜ì›ì‹œ ì˜í†µêµ¬ ê´‘êµë¡œ 105, 212í˜¸(ì´ì˜ë™, ê²½ê¸°R&DBì„¼í„°)
                """
                },
            {
                "role": "system",
                "content": """
                <êµìœ¡ ëª©í‘œ>
                1) ë°ì´í„° ì „ë¬¸ê°€ë¡œ ì–‘ì„±í•˜ì—¬ êµìœ¡ í›„ í˜„ì—… íˆ¬ì… ê°€ëŠ¥í•œ ì¸ë ¥ ì–‘ì„±
                2) íŒŒì´ì¬ ê¸°ì´ˆêµìœ¡ì„ í†µí•´ ë°ì´í„°ë¶„ì„ê°€ì˜ ì²«ê±¸ìŒì„ ì‹œì‘
                3) 4ì°¨ ì‚°ì—… ë©”ê°€íŠ¸ë ŒíŠ¸ì— ê±¸ë§ëŠ” ì¸ì¬ì—­ëŸ‰ í™•ë³´ ë° ë°©í–¥ ì œì‹œ
                """
                },
            {
                "role": "system",
                "content": """
                <êµìœ¡ ê³¼ì •>
                - ê²½ê¸°ëŒ€ ë¹…ë°ì´í„° ìº í”„ëŠ” ì‚¬ì „êµìœ¡(ì˜¨ë¼ì¸) â†’ ì´ë¡ êµìœ¡ â†’ íŒŒì´ì¬ ê¸°ì´ˆ â†’ í”„ë¡œì íŠ¸(ì‹¤ìŠµ) ê³¼ì •ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.

                1) ì‚¬ì „êµìœ¡
                - ì¥ì†Œ: ì˜¨ë¼ì¸ êµìœ¡
                - ì‚¬ì´íŠ¸: https://dataonair.or.kr/edu/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%AD%EB%85%84-%EC%BA%A0%ED%8D%BC%EC%8A%A4-%EC%82%AC%EC%A0%84%EA%B5%90%EC%9C%A1/
                - ë¹…ë°ì´í„° ê°œë… ì‚¬ì „ ì´í•´(ìˆ˜ì—…ì˜ ì´í•´ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´, ì „ ê°•ì˜ ì˜¨ë¼ì¸ êµìœ¡ ì´ìˆ˜ë¥¼ ê¶Œê³ í•©ë‹ˆë‹¤.)

                2) 1ì¼ì°¨
                - ì¥ì†Œ: ê²½ê¸°ëŒ€ ë¹…ë°ì´í„° ì„¼í„°
                - Introduction & Case Study

                3) 2ì¼ ~ 3ì¼ì°¨
                - ì¥ì†Œ: ê²½ê¸°ëŒ€ ë¹…ë°ì´í„° ì„¼í„°
                - íŒŒì´ì¬(Python) ê¸°ì´ˆêµìœ¡
                (1) ë°ì´í„° ë¶„ì„ í”„ë¡œì„¸ìŠ¤
                (2) íŒŒì´ì¬ ë¬¸ë²•
                (3) ë°ì´í„°ë¶„ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´í•´ ë° ì‹¤ìŠµ
                (4) ë°ì´í„°ë¶„ì„ ì „ì²˜ë¦¬/ì‹œê°í™”

                4) 4ì¼ ~ 5ì¼ì°¨
                - ì¥ì†Œ: ê²½ê¸°ëŒ€ ë¹…ë°ì´í„° ì„¼í„°
                - í”„ë¡œì íŠ¸(ì‹¤ìŠµ)
                (1) ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ ì§„í–‰ ë° ë°œí‘œ
                (2) íŒŒì´ì¬(Python)ì„ í™œìš©í•œ ì´ë¯¸ì§€ë°ì´í„°
                (3) ê¸°ì—… ì‹¤ ë°ì´í„° ë¶„ì„ ë° í™œìš©
                """
                },
            {
                "role": "system",
                "content": """
                <ìº í”„ ì‹ ì²­>
                - ë§í¬: https://booking.naver.com/booking/5/bizes/837802
                <ê²½ê¸°ëŒ€ ë¹…ë°ì´í„°ì„¼í„° í™ˆí˜ì´ì§€>
                - ë§í¬: https://www.kgu-bigdata.com/default/
                <ì¹´ì¹´ì˜¤í†¡ í”ŒëŸ¬ìŠ¤ ì¹œêµ¬>
                - ë§í¬: https://pf.kakao.com/_KAzxjxj
                """
                },
            {
                "role": "system",
                "content": """
                <ìì£¼ ë¬»ëŠ” ì§ˆë¬¸>
                Q. ì…”í‹€ë²„ìŠ¤ íƒ‘ìŠ¹ ì˜ˆì•½ì„ í•´ì•¼í•˜ë‚˜ìš”?
                A. ì˜ˆì•½í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. ë²„ìŠ¤ ìš´í–‰ì‹œê°„ ë° íƒ‘ìŠ¹ìœ„ì¹˜ëŠ” â€˜ë¹…ë°ì´í„°ìº í”„-ë¬´ë£Œ ì…”í‹€ë²„ìŠ¤â€™ í˜ì´ì§€ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.

                Q. ì£¼ë§ë„ ë¹…ë°ì´í„° ì„¼í„° ì´ìš© ê°€ëŠ¥í•œê°€ìš”?
                A. ì£¼ë§ì—ëŠ” ìš´ì˜í•˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.

                Q. í”„ë¡œì íŠ¸ ë° ë°ì´í„° ì•ˆì‹¬êµ¬ì—­ ë°©ë¬¸ ì¼ì •ì„ ë³€ê²½í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í•˜ë‚˜ìš”?
                A.ë¹…ë°ì´í„°ì„¼í„°ë¡œ ì—°ë½ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤. Tel: 031-888-5200 / Email: hsh@kgu-bigdata.com

                Q. êµìœ¡ ì‹ ì²­ ì ˆì°¨ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
                A. ì˜ˆì•½ í˜ì´ì§€ë¥¼ í†µí•´ 1ì¼ì°¨ ì´ë¡ êµìœ¡ì„ ì˜ˆì•½í•©ë‹ˆë‹¤. ë°ì´í„°ì•ˆì‹¬êµ¬ì—­ê³¼ í”„ë¡œì íŠ¸ëŠ” ì´ë¡ êµìœ¡ì— ì°¸ì„í•œ í•™ìƒë¶„ë“¤ì„ ëŒ€ìƒìœ¼ë¡œ í˜„ì¥ì—ì„œ ì ‘ìˆ˜í•©ë‹ˆë‹¤.

                Q. ì˜¨ë¼ì¸ ìˆ˜ê°• ê°€ëŠ¥í•œ ìœ íš¨ê¸°ê°„ì´ ë”°ë¡œ ìˆë‚˜ìš”?
                A. ì˜¨ë¼ì¸ ê°•ì˜ë¥¼ ìˆ˜ê°•í•˜ëŠ”ë° ìœ íš¨ê¸°ê°„ì€ ì—†ìŠµë‹ˆë‹¤. ë‹¨, ë¹…ë°ì´í„°ìº í”„ ì¸ì¦ì„œë¥¼ ë°›ê¸° ìœ„í•´ ì˜¨ë¼ì¸ ê°•ì˜ ì¸ì¦ì„œë¥¼ ì œì¶œí•˜ëŠ” ê²½ìš° ìœ íš¨ê¸°ê°„ì€ ì´ë¡ êµìœ¡ ì‹œì‘ í›„ 6ê°œì›”ì…ë‹ˆë‹¤. 6ê°œì›”ì´ ì§€ë‚œ ì˜¨ë¼ì¸ ê°•ì˜ ì¸ì¦ì„œëŠ” ì¸ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

                Q. ì£¼ì°¨ì¥ì´ ìˆë‚˜ìš”?
                A. ì£¼ì°¨ì¥ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ìµœì´ˆ 30ë¶„ ë¬´ë£Œ, ì¶”ê°€ 30ë¶„ë‹¹ 1,000ì›ì˜ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.                
                """
                },
            {
                "role": "user",
                "content": f'{user_input}'
                },
            ],
        temperature=1,
        max_tokens=512,
        top_p=1,
        frequency_penalty=0,
        presence_penalty=0
    )
    message = response.choices[0].message.content

    return message

st.image("https://www.kgu-bigdata.com/default/img/main/logo.png")
st.header("ğŸ¤– ê²½ê¸°ëŒ€ ë¹…ë°ì´í„°ì„¼í„° Chatbot(Demo)")
st.markdown("gpt-3.5-turboë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ì±—ë´‡ì…ë‹ˆë‹¤.")
st.markdown("[í™ˆí˜ì´ì§€](https://www.kgu-bigdata.com/default/)")

if 'generated' not in st.session_state:
    st.session_state['generated'] = ["ì•ˆë…•í•˜ì„¸ìš”! ë¹…ë°ì´í„° ìº í”„ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”? ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“ ì§€ ë§ì”€í•´ì£¼ì„¸ìš”."]

if 'past' not in st.session_state:
    st.session_state['past'] = ["ì•ˆë…•í•˜ì„¸ìš”"]

# í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì—¬ ë´‡ê³¼ ëŒ€í™” í•  ìˆ˜ ìˆëŠ” í¼ ìƒì„±
# clear_on_submit ì˜µì…˜ì„ í†µí•´ì„œ submit í•˜ë©´ í¼ì˜ ë‚´ìš©ì´ ì§€ì›Œì§
with st.form('form', clear_on_submit=True):
    user_input = st.text_input('ë‚˜:', '', key='input')
    submitted = st.form_submit_button('ì „ì†¡')

# ë©”ì‹œì§€ë¥¼ ì…ë ¥ í›„ ì „ì†¡ì„ ëˆ„ë¥¼ ê²½ìš°
if submitted and user_input:
    output = ask(user_input)
    st.session_state.past.append(user_input)
    st.session_state.generated.append(output)

# ì €ì¥ëœ ëŒ€í™” ë‚´ìš© ë³´ì—¬ì£¼ê¸°
if st.session_state['generated']:
    for i in range(len(st.session_state['generated'])-1, -1, -1):
        message(st.session_state['past'][i], is_user=True, key=str(i) + '_user')
        message(st.session_state["generated"][i], key=str(i))
